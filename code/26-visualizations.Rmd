---
title: "26-visualizations"
output: html_document
date: "2024-11-18"
---
Rmd to make visualizations for paper. 

https://yulab-smu.top/biomedical-knowledge-mining-book/enrichplot.html 

```{r}
library(ggplot2)
library(tidyverse)
library(dplyr)
library(RColorBrewer)
```


# Make a figure of the enriched GO Processes

Read in the list of 9 top enriched processes:
```{r}
top9 <- read.delim("../analyses/25-compare-2021-2022/2021-2022-entichedtop9_DAVID_separated.txt")
head(top9)
```
Goal: plots of the terms, x-axis is counts and color is benjamini value. 


```{r}

# Basic barplot
p <- ggplot(data=top9, aes(x=Count, y=Term, fill=Fold.Enrichment)) +
  geom_bar(stat="identity")+theme_minimal()
p

# Rename y-axis:


# Horizontal bar plot
p + coord_flip()
```

# Make a Venn Diagram of the DEGs for 2021, 2022, and the overlap... is this just numbers??

Total DEGS for 2021 --> 6938
Total amount unique to 2021 --> (6938-4114 =) 2824
Total DEGs for 2022 --> 6237
Total amount unique to 2022 --> (6237-4114 =) 2123
```{r}
#install.packages("ggVennDiagram")
library(ggVennDiagram)
```
```{r}
#install.packages("VennDiagram")
library(VennDiagram)
```



```{r}
# create pairwise Venn diagram 
draw.pairwise.venn(area1=6938, area2=6237,cross.area=4114, 
                   category=c("A","B"),fill=c("Red","Yellow"))
# 2D Venn diagram
ggVennDiagram(x) 
```

<<<<<<< HEAD
# Disease Progression and Mortality figure: 
Focusing on just the observations for the n=16 stars in 2021 (Exp A) and n=12 stars in 2022 (Exp B) 

https://cran.r-project.org/web/packages/vistime/vignettes/gg_vistime-vignette.html \    
https://shosaco.github.io/vistime/ 

 Goal -- timeline color-coded horizontal stacked bar... 

```{r}
#install.packages("vistime")
#install.packages("cowplot")
```


```{r}
### Load packages
library("vistime")
library("tidyverse")
library("RColorBrewer")
library("scales")
library("cowplot")
```

load in data
```{r}
data <- read.csv("../analyses/26-visualizations/expA-phenotype-data-for-figure.csv")
head(data)
```
https://github.com/wlhamilton/Patient-ward-movement-timelines/blob/main/R%20script%20to%20generate%20example%20ward%20movement%20plot.R 

```{r}
### Preparing for plot
## Colours
# Define number of colours needed
cols_n <- as.numeric(n_distinct(data$Disease_Sign))
# Check we have enough colours
ifelse(cols_n>12, 
       "More than 12 wards - not enough colours!",
       "12 wards or fewer - using Set3 colours")
# Select the colours from Set3 palette in RColorBrewer
cols_to_use <- brewer.pal(n = cols_n, name = "Set3")
```


```{r}
# Create mapping of colours to wards
col_sign_mapping <- data.frame(Disease_Sign=unique(c(as.character(data$Disease_Sign))), color=cols_to_use)
# merge in the mapping to the df
data_2 <- merge(data,
                      col_sign_mapping,
                      by="Disease_Sign",
                      all.x=T,all.y=T) %>%
  select(Sample_ID, Disease_Sign, start, end, Sample_Date, color) %>%
  arrange(Sample_Date, Sample_ID, start)
data_2
```

```{r}
## Extract sample dates
sample_dates <- data_2 %>%
  select(Sample_ID, Sample_Date) %>%
  distinct(Sample_ID, .keep_all=TRUE) %>%
  arrange(Sample_Date)
```

```{r}
### Plotting
# Produce the basic plot
plot_data <- gg_vistime(data = data_2,
                        col.group = "Sample_ID", # Each row will be a sample_ID - proxy for unique star
                        col.event = "Disease_Sign", # Rows will be coloured by the disease-sign
                        show_labels = FALSE, # Remove labels indicating the ward
                        linewidth = 20,
                        title = "Disease Progression timeline")
```







